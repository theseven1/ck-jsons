

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE" />
		<title>Content Filtering Block Page</title>
		<style>
		body {
			font-family:calibri, arial;
		}
		div#header {
			background: url("/logo.png") no-repeat center;
			height: 120px;
		}
		div#block_info {
			font-weight:bold;
			font-size:24px;
			text-align:center;
			line-height:32px;
			-moz-box-shadow: 0px 0px 4px rgba(0,0,0,0.55);
			-webkit-box-shadow: 0px 0px 4px rgba(0,0,0,0.55);
			box-shadow: 0px 0px 4px rgba(0,0,0,0.55);
		}
		.appblock {
			background-color:#800000;
			color: #fff;
		}
		.block {
			background-color:#bf9f45;
			color: #fff;
		}
		.coach {
			background-color:#bf9f45;
			color: #fff;
		}
		.authenticate {
			background-color:#bf9f45;
			color: #fff;
		}
		div#contact {
			font-weight:bold;
			text-align:center;
			font-size:16px;
			line-height:32px;
			-moz-box-shadow: 0px 0px 4px rgba(0,0,0,0.55);
			-webkit-box-shadow: 0px 0px 4px rgba(0,0,0,0.55);
			box-shadow: 0px 0px 4px rgba(0,0,0,0.55);
		}
		div#contact.authenticate a {
			color:#fff;
			text-decoration:none;
		}
		div#contact.coach a {
			color:#000;
			text-decoration:none;
		}
		div#contact.block a {
			color:#000;
			text-decoration:none;
		}
		div#policy, #notice, #rules {
			margin:20px;
		}
		#i_agree {
			margin-left: 20px;
		}
		#rules {
			width: 500px;
			height: 50px;
			overflow-y: scroll;
			resize: none;
			padding: 0;
		}
		.policy {
			text-align:center;
			font-weight:bold;
		}
		.notice, .rules {
			border: 2px #000000 solid;
			padding: 5px;
			width: 600px;
			border-radius: 5px;
			margin-bottom: 12px;
			display: inline-block;
		}
		div#block_message {
			margin: 20px;
		}
		.url_info {
			font-weight:bold;
			color:#606062;
		}
		.mainDiv {
			width:600px;
			margin:0;
			padding:0;
			background-color:#FFFFFF;
			margin-right:auto;
			margin-left:auto;
		}
		</style>
		<!-- Removed external JS reference as requested logic is now handled internally -->
		<script>
			// --- HELPER FUNCTIONS ---

			// Custom function to get parameters, capable of joining multiple values (like categories)
			function getQueryVariable(variable) {
				var query = window.location.search.substring(1);
				var vars = query.split('&');
				var results = [];
				for (var i = 0; i < vars.length; i++) {
					var pair = vars[i].split('=');
					if (decodeURIComponent(pair[0]) == variable) {
						// Replace + with space and decode
						results.push(decodeURIComponent(pair[1].replace(/\+/g, ' ')));
					}
				}
				if (results.length === 0) return "";
				return results.join(', '); // Join duplicates with comma
			}

			function getCurrentTime() {
				return new Date().toString().split(' GMT')[0];
			}

			// --- MAIN LOGIC ---

			function writeContent() {
				// 1. Capture Cloudflare Variables
				var cf_site_uri = getQueryVariable('cf_site_uri');
				var cf_categories = getQueryVariable('cf_request_category_names');
				if (cf_categories === "") {
					cf_categories = "Non-Managed";
				}
				var cf_rule_id = getQueryVariable('cf_rule_id');
				var cf_source_ip = getQueryVariable('cf_source_ip');
				var cf_user_email = getQueryVariable('cf_user_email');
				var cf_filter = getQueryVariable('cf_filter');
				var cf_application_names = getQueryVariable('cf_application_names');
				
				// Standard strings
				var BlockHeader = "RESTRICTED";
				var AppBlockHeader = "RESTRICTED BY APP DEFENDER";
				
				// Initialize DOM Elements
				var sBlockInfoElement = document.getElementById("block_info");
				var sBlockMsgElement = document.getElementById("block_message");
				var sContactElement = document.getElementById("contact");
				var sPolicyElement = document.getElementById("policy");
				var sPolicyClassElement = document.getElementsByClassName("policy");

				// Generate the User HTML line only if email exists
				var userHtmlLine = "";
				if(cf_user_email && cf_user_email !== "") {
					userHtmlLine = "<span class='url_info'>User: &nbsp;&nbsp;</span><span id='USER'>" + cf_user_email + "</span><br />";
				}

				// Generate Button HTML (Non-functional as requested)
				var buttonHTML = "<div>" + 
					"<div id='loginSubmitOptions' style='display:block;'>" +
					"<input type='Button' value='Login' onclick='void(0)' style='width:90px;'>" + // Removed functionality
					"</div></div>";

				// --- MODE SELECTION ---

				if (cf_application_names && cf_application_names !== "") {
					// --- APP DEFENDER MODE ---
					sPolicyClassElement[0].style.color = "#bf9f45";
					sBlockInfoElement.innerHTML = AppBlockHeader;
					sBlockInfoElement.className = "appblock";
					sContactElement.className = "appblock";

					var AppBlockMessage = "You have been restricted by the district's internet filter policy.<a href='#' style='color: #CC0000'></a><br /><br /> " +
						"<span class='url_info'>URL: &nbsp;&nbsp;</span><span id='URL'><b>" + cf_site_uri + "</b></span><br />" +
						"<span class='url_info'>Application: &nbsp;&nbsp;</span><span id='APP'><b>" + cf_application_names + "</b></span><br />" +
						"<span class='url_info'>URL Categories: &nbsp;&nbsp;</span><span id='URL_Cat'><b>" + cf_categories + "</b></span><br />" +
						"<span class='url_info'>Filter: &nbsp;&nbsp;</span><span id='FILTER'><b>" + cf_filter + "</b></span><br />" +
						"<span class='url_info'>Policy: &nbsp;&nbsp;</span><span id='WHY'><b>" + cf_rule_id + "</b></span><br />" +
						userHtmlLine + 
						"<span class='url_info'>User's IP: &nbsp;&nbsp;</span><span><b>" + cf_source_ip + "</b></span><br />" +
						"<span class='url_info'>Timestamp: &nbsp;&nbsp;</span><span><b>" + getCurrentTime() + "</b></span>";
					
					sBlockMsgElement.innerHTML = AppBlockMessage;

				} else {
					// --- STANDARD BLOCK MODE ---
					sPolicyClassElement[0].style.color = "#bf9f45";
					sBlockInfoElement.innerHTML = BlockHeader;
					sBlockInfoElement.className = "block";
					sContactElement.className = "block";

					var BlockMessage = "You have been restricted by the district's Internet Filtering Policy. Use this link to request the site evaluation or contact the TSC. <a href='mailto:info@mkseven1.com'>Website Filtering Request</a>" +
						"<a href='#' style='color: #CC0000'></a><br /><br />" +
						"<span class='url_info'>URL: &nbsp;&nbsp;</span><span id='URL'><b>" + cf_site_uri + "</b></span><br />" +
						"<span class='url_info'>URL Categories: &nbsp;&nbsp;</span><span id='URL_Cat'><b>" + cf_categories + "</b></span><br />" +
						"<span class='url_info'>Filter: &nbsp;&nbsp;</span><span id='FILTER'><b>" + cf_filter + "</b></span><br />" +
						"<span class='url_info'>Policy: &nbsp;&nbsp;</span><span id='WHY'><b>" + cf_rule_id + "</b></span><br />" +
						userHtmlLine +
						"<span class='url_info'>User's IP: &nbsp;&nbsp;</span><span><b>" + cf_source_ip + "</b></span><br />" +
						"<span class='url_info'>Timestamp: &nbsp;&nbsp;</span><span><b>" + getCurrentTime() + "</b></span><br /><br />" +
						"For Staff, please use the Login button to receive the Staff Policy<br><br>" +
						"<center>";
					
					BlockMessage += buttonHTML;
					sBlockMsgElement.innerHTML = BlockMessage;
				}

				// Standard Policy Text Append
				var sPolicyBlock = "The site requested has been blocked because it does not comply with the filtering requirements as described by CIPA, COPPA and district guidelines for online safety.";
				if (sPolicyElement) {
					sPolicyElement.innerHTML += sPolicyBlock;
				}
			}
		</script>
	</head>
	<body onLoad="writeContent();">
		<div id="wrapper">
			<div class="mainDiv">
				<div id="header">
				</div>
				<div id="block_info">
				</div>
				<div id="block_message">
				</div>
				<hr style="background-color:#606062;height:2px;border:none;" />
				<div id="footer">
					<div id="policy">
						<div class="policy">Acceptable Use Policy</div>
					</div>
					
					<!-- Logic for Coach/Agree rules hidden as logic is simplified for CF, kept structure if needed -->
					<div id="accept_rules" style="display:none;">
						<div class="notice">
							<span id="notice">To proceed, please read and acknowledge the following:</span>
						</div>
						<div class="rules">
							<textarea readonly id="rules">This is a warning page...</textarea>
							<input type="button" value="Continue" id="i_agree">
						</div>
					</div>

					<div id="contact">
						&nbsp; 
					</div>
					<br /><br /><br /><br /><br /><br />
				</div>
			</div>
		</div>
</body>
</html>
